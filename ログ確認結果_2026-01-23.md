# ğŸ“Š ãƒ­ã‚°ç¢ºèªçµæœ - 2026å¹´1æœˆ23æ—¥

**ç¢ºèªæ—¥æ™‚**: 2026å¹´1æœˆ23æ—¥

---

## âœ… è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹

### 1. ãƒ‡ãƒ¼ã‚¿ã¯æ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ï¼

```sql
sqlite> SELECT COUNT(*) FROM sessions;
9  â† 9ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹
```

### 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã®å†…è¨³

```sql
sqlite> SELECT status, COUNT(*) FROM sessions GROUP BY status;
active|1      â† ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³: 1ä»¶
completed|8   â† å®Œäº†ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³: 8ä»¶
```

**é‡è¦**: `settled` ãŒ0ä»¶ã«ãªã£ã¦ã„ã¾ã™ï¼
â†’ ã“ã‚Œã¯ã€ä»¥å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã™ã¹ã¦ `completed` ã«ç§»è¡Œã—ãŸã‹ã€ã¾ãŸã¯æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã§ä½œæˆã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ãŒæ®‹ã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

### 3. sqlite3ãŒæ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ âœ…

```bash
sqlite3 (3.40.1-2+deb12u2) ã‚’è¨­å®šã—ã¦ã„ã¾ã™ ...
```

ã“ã‚Œã§ã€Raspberry Piä¸Šã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

## ğŸ” æ¬¡ã«ç¢ºèªã™ã¹ãã“ã¨

### å®Ÿéš›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹

Raspberry Piã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```sql
-- ã™ã¹ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ—¥ä»˜ã‚’ç¢ºèª
SELECT id, status, created_at FROM sessions ORDER BY created_at DESC;

-- ã¾ãŸã¯ã€æœ€æ–°5ä»¶ã‚’è¡¨ç¤º
.headers on
.mode column
SELECT
  substr(id, 1, 10) as id_short,
  status,
  substr(created_at, 1, 10) as date,
  substr(created_at, 12, 8) as time
FROM sessions
ORDER BY created_at DESC
LIMIT 5;

-- ç‰¹å®šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©³ç´°ï¼ˆJSONãƒ‡ãƒ¼ã‚¿ï¼‰
SELECT data FROM sessions WHERE status = 'active';
```

### ãªãœæ—¥ä»˜æ¤œç´¢ã§çµæœãŒå‡ºãªã‹ã£ãŸã‹

```sql
sqlite> SELECT id, status, created_at FROM sessions WHERE DATE(created_at) = '2026-01-22';
ï¼ˆçµæœãªã—ï¼‰

sqlite> SELECT id, status, created_at FROM sessions WHERE DATE(created_at) = '2026-01-24';
ï¼ˆçµæœãªã—ï¼‰

sqlite> SELECT id, status, created_at FROM sessions WHERE DATE(created_at) = '2026-01-25';
ï¼ˆçµæœãªã—ï¼‰
```

**å¯èƒ½æ€§**:
1. created_at ãŒ ISO8601å½¢å¼ï¼ˆä¾‹: `2026-01-23T10:00:00.000Z`ï¼‰ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹
2. ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®é•ã„ï¼ˆUTCã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ—¥æœ¬æ™‚é–“ã¨9æ™‚é–“ãšã‚Œã‚‹ï¼‰
3. å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã®æ—¥ä»˜ãŒäºˆæƒ³ã¨é•ã†

**ç¢ºèªæ–¹æ³•**:
```sql
-- ã™ã¹ã¦ã®æ—¥ä»˜ã‚’è¡¨ç¤º
SELECT DISTINCT DATE(created_at) as date FROM sessions ORDER BY date;

-- ã¾ãŸã¯ã€created_atã‚’ãã®ã¾ã¾è¡¨ç¤º
SELECT id, created_at FROM sessions LIMIT 5;
```

---

## ğŸ“ çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®è¬ãŒè§£ã‘ãŸ

### ãªãœ `npm run export-json:stats` ã§0ä»¶ã ã£ãŸã®ã‹

**åŸå› **: ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã„ãŸ

```
npm run export-json:stats
â†’ src/data/database.db ã‚’è¦‹ã‚‹ï¼ˆç©ºï¼‰
â†’ ğŸ“ˆ ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: 0ä»¶

sqlite3 dist/data/database.db
â†’ dist/data/database.db ã‚’è¦‹ã‚‹ï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
â†’ 9ä»¶
```

### æ­£ã—ã„ç¢ºèªæ–¹æ³•

**æ–¹æ³•A: sqlite3ã‚³ãƒãƒ³ãƒ‰ï¼ˆæ¨å¥¨ï¼‰**
```bash
cd ~/tatekaezamurai-bot/server
sqlite3 dist/data/database.db
```

**æ–¹æ³•B: npm scriptã‚’ä¿®æ­£**

`package.json` ã‚’ä¿®æ­£ã—ã¦ã€æœ¬ç•ªDBã‚’è¦‹ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼š

```json
"export-json:stats": "node dist/scripts/export-json.js --stats"
```

ï¼ˆãŸã ã—ã€äº‹å‰ã« `npm run build` ãŒå¿…è¦ï¼‰

---

## ğŸ¯ ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã®ç¢ºèª

### ã€Œç²¾ç®—ã€ã§è‡ªå‹•çµ‚äº†ã™ã‚‹å¤‰æ›´

**ã‚³ãƒŸãƒƒãƒˆæ¸ˆã¿**:
- `status: 'settled'` â†’ `status: 'completed'`
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã—ã¾ã—ãŸğŸ’«ã€ã‚’è¿½åŠ 

### Raspberry Piã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

```bash
# 1. æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
cd ~/tatekaezamurai-bot
git pull origin main

# 2. ãƒ“ãƒ«ãƒ‰
cd server
npm run build

# 3. ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
pm2 restart all

# 4. ãƒ­ã‚°ã§ç¢ºèª
pm2 logs --lines 50
```

### å‹•ä½œç¢ºèªï¼ˆLINEã§ï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: é–‹å§‹
Bot: âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼: å‚åŠ 
Bot: âœ… ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 

ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1è»’ç›® 5000
Bot: âœ… 1è»’ç›® 5,000å†† è¨˜éŒ²ï¼

ãƒ¦ãƒ¼ã‚¶ãƒ¼: ç²¾ç®—
Bot:
ğŸ’µ æ¸…ç®—çµæœ
...

ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã—ã¾ã—ãŸğŸ’«  â† ã“ã‚ŒãŒè¿½åŠ ã•ã‚Œã‚‹
```

---

## ğŸ“Š ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ³

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç·æ•°: 9ä»¶

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ä»¶æ•° | èª¬æ˜ |
|-----------|------|------|
| `active` | 1ä»¶ | ç¾åœ¨é€²è¡Œä¸­ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| `completed` | 8ä»¶ | å®Œäº†ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| `settled` | 0ä»¶ | ãªã—ï¼ˆæ–°ã—ã„ä»•æ§˜ã§ä¸è¦ï¼‰ |

### æ¬¡ã®ç¢ºèªé …ç›®

1. **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©³ç´°**
   ```sql
   SELECT data FROM sessions WHERE status = 'active';
   ```

2. **æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å±¥æ­´**
   ```sql
   SELECT
     id,
     status,
     created_at,
     updated_at
   FROM sessions
   ORDER BY updated_at DESC
   LIMIT 5;
   ```

3. **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®ç¢ºèª**
   ```sql
   SELECT created_at FROM sessions LIMIT 1;
   ```
   â†’ `2026-01-23T10:00:00.000Z` ã®ã‚ˆã†ãªå½¢å¼ãªã‚‰ã€Zã¯ UTCï¼ˆå”å®šä¸–ç•Œæ™‚ï¼‰
   â†’ æ—¥æœ¬æ™‚é–“ã¯ +9æ™‚é–“

---

## âœ… ä»Šå¾Œã®æ”¹å–„ææ¡ˆ

### 1. npm scriptã®ä¿®æ­£

`package.json` ã«è¿½åŠ ï¼š

```json
"export-json:stats:prod": "sqlite3 dist/data/database.db < scripts/stats.sql"
```

`scripts/stats.sql` ã‚’ä½œæˆ:
```sql
.headers on
.mode column

SELECT 'ğŸ“Š ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ï¼‰' as info;
SELECT status, COUNT(*) as count FROM sessions GROUP BY status;

SELECT '' as space;
SELECT 'ğŸ’° æ”¯æ‰•ã„çµ±è¨ˆ' as info;
-- JSONå†…ã®paymentsé…åˆ—ã‚’é›†è¨ˆï¼ˆè¤‡é›‘ãªã®ã§çœç•¥å¯èƒ½ï¼‰

SELECT '' as space;
SELECT 'ğŸ“… æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³' as info;
SELECT
  substr(id, 1, 10) as id,
  status,
  substr(created_at, 1, 19) as created
FROM sessions
ORDER BY created_at DESC
LIMIT 10;
```

### 2. ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ

æ—¥æœ¬æ™‚é–“ã§è¡¨ç¤ºã—ãŸã„å ´åˆã€SQLiteã§å¤‰æ›:

```sql
-- UTC â†’ JST (+9æ™‚é–“)
SELECT
  datetime(created_at, '+9 hours') as jst_time
FROM sessions;
```

---

## ğŸ‰ ã¾ã¨ã‚

| é …ç›® | çµæœ |
|------|------|
| **ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨** | âœ… 9ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ |
| **sqlite3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«** | âœ… æˆåŠŸ |
| **çµ±è¨ˆè¡¨ç¤ºã®å•é¡Œ** | ğŸ” åŸå› åˆ¤æ˜ï¼ˆç•°ãªã‚‹DBãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ |
| **ã‚³ãƒ¼ãƒ‰å¤‰æ›´** | âœ… GitHubã«pushæ¸ˆã¿ |
| **æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—** | Raspberry Piã§ `git pull` â†’ `npm run build` â†’ `pm2 restart` |

---

**Raspberry Piã§æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚Œã°ã€ã€Œç²¾ç®—ã€ã§è‡ªå‹•çµ‚äº†ã™ã‚‹æ–°ã—ã„å‹•ä½œã‚’ç¢ºèªã§ãã¾ã™ï¼** ğŸ¯
