# ğŸ” ãƒ‡ãƒ¼ã‚¿ç¢ºèªæ‰‹é †ï¼ˆRaspberry Piï¼‰

**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ23æ—¥
**å¯¾è±¡**: Raspberry Piä¸Šã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ãŸã„äºº

---

## ğŸš¨ ç¾åœ¨ã®çŠ¶æ³

ãƒ­ã‚°ã‹ã‚‰ä»¥ä¸‹ã®ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸï¼š

1. âœ… ã‚µãƒ¼ãƒãƒ¼ã¯æ­£å¸¸ç¨¼åƒä¸­
2. âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç©ºï¼ˆ0ä»¶ï¼‰
3. âŒ `sqlite3` ã‚³ãƒãƒ³ãƒ‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

---

## ğŸ”§ Step 1: sqlite3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Raspberry Piã«æ¥ç¶š
ssh sk283@raspberrypi.local

# sqlite3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get update
sudo apt-get install -y sqlite3

# ç¢ºèª
sqlite3 --version
# â†’ SQLite version 3.37.2 ãªã©ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

---

## ğŸ” Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’ç¢ºèª

**é‡è¦**: 2ã¤ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```bash
cd ~/tatekaezamurai-bot/server

# 1. æœ¬ç•ªç’°å¢ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‹ï¼‰
ls -lh dist/data/database.db

# 2. é–‹ç™ºç’°å¢ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆnpm scriptsãŒä½¿ã£ã¦ã„ã‚‹ï¼‰
ls -lh src/data/database.db
```

### ã©ã¡ã‚‰ã‚’è¦‹ã‚‹ã¹ãï¼Ÿ

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” | ç¢ºèªæ–¹æ³• |
|---------|------|---------|
| `dist/data/database.db` | **æœ¬ç•ªç’°å¢ƒ**ï¼ˆpm2ã§èµ·å‹•ï¼‰ | pm2ã§èµ·å‹•ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ãŒä½¿ç”¨ |
| `src/data/database.db` | é–‹ç™ºç’°å¢ƒï¼ˆnpm run devãªã©ï¼‰ | ts-nodeã§ç›´æ¥å®Ÿè¡Œæ™‚ã«ä½¿ç”¨ |

**é€šå¸¸ã¯ `dist/data/database.db` ã‚’ç¢ºèªã—ã¾ã™ã€‚**

---

## ğŸ“Š Step 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸­èº«ã‚’ç¢ºèª

### æ–¹æ³•A: npmã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœ€ã‚‚ç°¡å˜ï¼‰

```bash
cd ~/tatekaezamurai-bot/server

# çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
npm run export-json:stats
```

**æ³¨æ„**: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ `src/data/database.db` ã‚’è¦‹ã¦ã„ã¾ã™ã€‚
æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ãŸã„å ´åˆã¯ã€æ–¹æ³•Bã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚

### æ–¹æ³•B: sqlite3ã‚³ãƒãƒ³ãƒ‰ï¼ˆæœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªï¼‰

```bash
cd ~/tatekaezamurai-bot/server

# æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ã
sqlite3 dist/data/database.db
```

SQLiteãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```
SQLite version 3.37.2 2022-01-06 13:25:41
Enter ".help" for usage hints.
sqlite>
```

#### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```sql
-- ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’ç¢ºèª
SELECT COUNT(*) FROM sessions;

-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã®ä»¶æ•°
SELECT status, COUNT(*) as count
FROM sessions
GROUP BY status;

-- æœ€æ–°5ä»¶ã‚’è¡¨ç¤º
SELECT id, status, created_at
FROM sessions
ORDER BY created_at DESC
LIMIT 5;

-- çµ‚äº†
.exit
```

### æ–¹æ³•C: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã§ç¢ºèª

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ç¢ºèª
ls -lh dist/data/database.db

# å‡ºåŠ›ä¾‹:
# -rw-r--r-- 1 sk283 sk283 20K 1æœˆ 23 10:00 database.db
```

- **20KBä»¥ä¸‹** â†’ ãŸã¶ã‚“ãƒ‡ãƒ¼ã‚¿ãŒç©º
- **100KBä»¥ä¸Š** â†’ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹

---

## ğŸ—‚ï¸ Step 4: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç©ºã§ã‚‚ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèª
ls -lh dist/data/backups/

# æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
ls -lt dist/data/backups/ | head -5

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¦‹ã‚‹ï¼ˆJSONå½¢å¼ï¼‰
cat dist/data/backups/sessions_2026-01-22.json | head -20
```

---

## ğŸ”„ Step 5: ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œï¼ˆå¿…è¦ãªå ´åˆï¼‰

ã‚‚ã— `src/data/database.db` ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€`dist/data/database.db` ãŒç©ºã®å ´åˆï¼š

```bash
cd ~/tatekaezamurai-bot/server

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚³ãƒ”ãƒ¼
cp src/data/database.db dist/data/database.db

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
pm2 restart all

# ç¢ºèª
npm run export-json:stats
```

---

## ğŸ“ ç¾åœ¨ã®çŠ¶æ³ã®è¨ºæ–­

ãƒ­ã‚°ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨ºæ–­ã§ãã¾ã™ï¼š

### ã‚±ãƒ¼ã‚¹1: å®Œå…¨ã«æ–°ã—ã„ç’°å¢ƒ

```
ğŸ“ˆ ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ï¼‰:
ï¼ˆä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼‰

ğŸ’° æ”¯æ‰•ã„çµ±è¨ˆ:
   ç·æ”¯æ‰•ã„ä»¶æ•°: 0ä»¶
```

â†’ **æ­£å¸¸ã§ã™**ã€‚ã¾ã èª°ã‚‚botã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ã€‚

**å¯¾å¿œ**: ã‚°ãƒ«ãƒ¼ãƒ—ã§botã‚’ä½¿ãˆã°ã€ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã¾ã™ã€‚

### ã‚±ãƒ¼ã‚¹2: ãƒ‡ãƒ¼ã‚¿ãŒåˆ¥ã®å ´æ‰€ã«ã‚ã‚‹

`dist/data/database.db` ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãŒã€`npm run export-json:stats` ã¯ `src/data/database.db` ã‚’è¦‹ã¦ã„ã‚‹ã€‚

**å¯¾å¿œ**:
```bash
# æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç›´æ¥ç¢ºèª
sqlite3 dist/data/database.db "SELECT COUNT(*) FROM sessions;"
```

### ã‚±ãƒ¼ã‚¹3: ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆãŸ

ä»¥å‰ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆãŸå ´åˆã€‚

**å¯¾å¿œ**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
```bash
# æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç¢ºèª
ls -lt dist/data/backups/

# å¾©å…ƒ
cp dist/data/backups/sessions_2026-01-22.json src/data/sessions.json

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ï¼ˆè‡ªå‹•çš„ã«SQLiteã«ç§»è¡Œã•ã‚Œã‚‹ï¼‰
pm2 restart all
```

---

## ğŸ¯ æ¨å¥¨ã™ã‚‹ç¢ºèªæ‰‹é †ï¼ˆã¾ã¨ã‚ï¼‰

```bash
# 1. sqlite3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
sudo apt-get install -y sqlite3

# 2. Raspberry Piã«æ¥ç¶š
ssh sk283@raspberrypi.local
cd ~/tatekaezamurai-bot/server

# 3. æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª
sqlite3 dist/data/database.db "SELECT COUNT(*) FROM sessions;"

# 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã®ä»¶æ•°
sqlite3 dist/data/database.db "SELECT status, COUNT(*) FROM sessions GROUP BY status;"

# 5. ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®å ´åˆã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç¢ºèª
ls -lt dist/data/backups/
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1. sqlite3ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„

```bash
# ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ
sudo apt-get update
sudo apt-get upgrade

# å†åº¦è©¦ã™
sudo apt-get install -y sqlite3
```

### Q2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™
find ~/tatekaezamurai-bot -name "database.db" -type f
```

### Q3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç ´æã—ã¦ã„ã‚‹

```bash
# æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
sqlite3 dist/data/database.db "PRAGMA integrity_check;"

# å‡ºåŠ›: ok â†’ æ­£å¸¸
# å‡ºåŠ›: ã‚¨ãƒ©ãƒ¼ â†’ ç ´æã—ã¦ã„ã‚‹

# ç ´æã—ã¦ã„ã‚‹å ´åˆã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
```

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **sqlite3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸­èº«ã‚’ç¢ºèª**
3. **ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ**:
   - ã‚°ãƒ«ãƒ¼ãƒ—ã§botã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆ
   - ã¾ãŸã¯ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ

4. **ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆ**:
   - çµ±è¨ˆæƒ…å ±ã‚’ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿åˆ†æ

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```
â–¡ sqlite3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ
â–¡ dist/data/database.db ã®å­˜åœ¨ã‚’ç¢ºèªã—ãŸ
â–¡ ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’ç¢ºèªã—ãŸ
â–¡ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ãŸ
â–¡ ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®ç†ç”±ã‚’ç†è§£ã—ãŸ
```

---

**ã“ã®æ‰‹é †ã§ã€Raspberry Piä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’æ­£ç¢ºã«ç¢ºèªã§ãã¾ã™ï¼** ğŸ”
